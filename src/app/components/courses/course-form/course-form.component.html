<div class="course-form">
  <!-- Header -->
  <div class="page-header mb-6">
    <div class="header-content">
      <h1>{{ isEditMode ? 'Edit Course' : 'Create New Course' }}</h1>
      <p class="text-muted">{{ isEditMode ? 'Update course information' : 'Fill in the details to create a new course' }}</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="onCancel()">
        <i class="fas fa-times mr-2"></i> Cancel
      </button>
      <button class="btn btn-primary" (click)="onSubmit()" [disabled]="submitting">
        <i class="fas fa-save mr-2"></i> 
        {{ submitting ? 'Saving...' : (isEditMode ? 'Update' : 'Create') }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading course data...</p>
  </div>

  <!-- Form -->
  <div *ngIf="!loading" class="form-container">
    <form [formGroup]="courseForm" (ngSubmit)="onSubmit()">
      <!-- Basic Information -->
      <div class="form-section">
        <div class="section-header">
          <h3><i class="fas fa-info-circle mr-2"></i> Basic Information</h3>
        </div>
        
        <div class="form-grid">
          <!-- Course Name -->
          <div class="form-group" [class.error]="courseForm.get('courseName')?.invalid && courseForm.get('courseName')?.touched">
            <label for="courseName">Course Name *</label>
            <input 
              type="text" 
              id="courseName" 
              formControlName="courseName"
              placeholder="e.g., Data Structures"
              class="form-control">
            <div class="error-message" *ngIf="courseForm.get('courseName')?.invalid && courseForm.get('courseName')?.touched">
              Course name is required
            </div>
          </div>

          <!-- Course Code -->
          <div class="form-group" [class.error]="courseForm.get('courseCode')?.invalid && courseForm.get('courseCode')?.touched">
            <label for="courseCode">Course Code *</label>
            <input 
              type="text" 
              id="courseCode" 
              formControlName="courseCode"
              placeholder="e.g., CS201"
              class="form-control">
            <div class="error-message" *ngIf="courseForm.get('courseCode')?.invalid && courseForm.get('courseCode')?.touched">
              <span *ngIf="courseForm.get('courseCode')?.errors?.['required']">Course code is required</span>
              <span *ngIf="courseForm.get('courseCode')?.errors?.['pattern']">Format: 2-4 letters + 3-4 digits (e.g., CS101)</span>
            </div>
          </div>

          <!-- Credit Hours -->
          <div class="form-group" [class.error]="courseForm.get('creditHours')?.invalid && courseForm.get('creditHours')?.touched">
            <label for="creditHours">Credit Hours *</label>
            <input 
              type="number" 
              id="creditHours" 
              formControlName="creditHours"
              placeholder="e.g., 3"
              class="form-control">
            <div class="error-message" *ngIf="courseForm.get('creditHours')?.invalid && courseForm.get('creditHours')?.touched">
              <span *ngIf="courseForm.get('creditHours')?.errors?.['required']">Credit hours are required</span>
              <span *ngIf="courseForm.get('creditHours')?.errors?.['min']">Minimum 1 credit hour</span>
              <span *ngIf="courseForm.get('creditHours')?.errors?.['max']">Maximum 6 credit hours</span>
            </div>
          </div>

          <!-- Department -->
          <div class="form-group" [class.error]="courseForm.get('department')?.invalid && courseForm.get('department')?.touched">
            <label for="department">Department *</label>
            <select id="department" formControlName="department" class="form-control">
              <option value="">Select Department</option>
              <option *ngFor="let dept of departments" [value]="dept._id">
                {{ dept.departmentName }} ({{ dept.departmentCode }})
              </option>
            </select>
            <div class="error-message" *ngIf="courseForm.get('department')?.invalid && courseForm.get('department')?.touched">
              Department is required
            </div>
          </div>

          <!-- Semester -->
          <div class="form-group" [class.error]="courseForm.get('semester')?.invalid && courseForm.get('semester')?.touched">
            <label for="semester">Semester *</label>
            <select id="semester" formControlName="semester" class="form-control">
              <option value="">Select Semester</option>
              <option *ngFor="let semester of semesters" [value]="semester">
                {{ semester }}
              </option>
            </select>
            <div class="error-message" *ngIf="courseForm.get('semester')?.invalid && courseForm.get('semester')?.touched">
              Semester is required
            </div>
          </div>

          <!-- Year -->
          <div class="form-group" [class.error]="courseForm.get('year')?.invalid && courseForm.get('year')?.touched">
            <label for="year">Year *</label>
            <select id="year" formControlName="year" class="form-control">
              <option value="">Select Year</option>
              <option *ngFor="let year of years" [value]="year">
                Year {{ year }}
              </option>
            </select>
            <div class="error-message" *ngIf="courseForm.get('year')?.invalid && courseForm.get('year')?.touched">
              Year is required
            </div>
          </div>

          <!-- Course Type -->
          <div class="form-group" [class.error]="courseForm.get('courseType')?.invalid && courseForm.get('courseType')?.touched">
            <label for="courseType">Course Type *</label>
            <select id="courseType" formControlName="courseType" class="form-control">
              <option value="">Select Course Type</option>
              <option *ngFor="let type of courseTypes" [value]="type">
                {{ type }}
              </option>
            </select>
            <div class="error-message" *ngIf="courseForm.get('courseType')?.invalid && courseForm.get('courseType')?.touched">
              Course type is required
            </div>
          </div>

          <!-- Max Students -->
          <div class="form-group" [class.error]="courseForm.get('maxStudents')?.invalid && courseForm.get('maxStudents')?.touched">
            <label for="maxStudents">Maximum Students *</label>
            <input 
              type="number" 
              id="maxStudents" 
              formControlName="maxStudents"
              placeholder="e.g., 40"
              class="form-control">
            <div class="error-message" *ngIf="courseForm.get('maxStudents')?.invalid && courseForm.get('maxStudents')?.touched">
              <span *ngIf="courseForm.get('maxStudents')?.errors?.['required']">Maximum students is required</span>
              <span *ngIf="courseForm.get('maxStudents')?.errors?.['min']">Minimum 1 student required</span>
              <span *ngIf="courseForm.get('maxStudents')?.errors?.['max']">Maximum 100 students allowed</span>
            </div>
          </div>

          <!-- Status -->
          <div class="form-group">
            <label for="status">Status</label>
            <select id="status" formControlName="status" class="form-control">
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Instructor Information -->
      <div class="form-section">
        <div class="section-header">
          <h3><i class="fas fa-chalkboard-teacher mr-2"></i> Instructor Information</h3>
        </div>
        
        <div class="form-grid" formGroupName="instructor">
          <!-- Instructor Name -->
          <div class="form-group">
            <label for="instructorName">Instructor Name</label>
            <input 
              type="text" 
              id="instructorName" 
              formControlName="name"
              placeholder="Enter instructor name"
              class="form-control">
          </div>

          <!-- Instructor Email -->
          <div class="form-group" [class.error]="courseForm.get('instructor.email')?.invalid && courseForm.get('instructor.email')?.touched">
            <label for="instructorEmail">Email</label>
            <input 
              type="email" 
              id="instructorEmail" 
              formControlName="email"
              placeholder="Enter instructor email"
              class="form-control">
            <div class="error-message" *ngIf="courseForm.get('instructor.email')?.invalid && courseForm.get('instructor.email')?.touched">
              Invalid email format
            </div>
          </div>

          <!-- Instructor Phone -->
          <div class="form-group" [class.error]="courseForm.get('instructor.phone')?.invalid && courseForm.get('instructor.phone')?.touched">
            <label for="instructorPhone">Phone</label>
            <input 
              type="tel" 
              id="instructorPhone" 
              formControlName="phone"
              placeholder="Enter instructor phone"
              class="form-control">
            <div class="error-message" *ngIf="courseForm.get('instructor.phone')?.invalid && courseForm.get('instructor.phone')?.touched">
              10-11 digits required
            </div>
          </div>
        </div>
      </div>

      <!-- Schedule -->
      <div class="form-section">
        <div class="section-header">
          <h3><i class="fas fa-calendar-alt mr-2"></i> Schedule</h3>
        </div>
        
        <div class="form-grid" formGroupName="schedule">
          <!-- Days of Week -->
          <div class="form-group">
            <label>Class Days</label>
            <div class="days-selector">
              <button 
                *ngFor="let day of daysOfWeek"
                type="button"
                class="day-btn"
                [class.selected]="isDaySelected(day)"
                (click)="toggleDaySelection(day)">
                {{ day.slice(0, 3) }}
              </button>
            </div>
          </div>

          <!-- Time -->
          <div class="form-group">
            <label for="startTime">Start Time</label>
            <input 
              type="time" 
              id="startTime" 
              class="form-control"
              formControlName="start"
              [ngModel]="courseForm.get('schedule.time.start')?.value"
              (ngModelChange)="courseForm.get('schedule.time.start')?.setValue($event)">
          </div>

          <div class="form-group">
            <label for="endTime">End Time</label>
            <input 
              type="time" 
              id="endTime" 
              class="form-control"
              formControlName="end"
              [ngModel]="courseForm.get('schedule.time.end')?.value"
              (ngModelChange)="courseForm.get('schedule.time.end')?.setValue($event)">
          </div>

          <!-- Room -->
          <div class="form-group">
            <label for="room">Room</label>
            <input 
              type="text" 
              id="room" 
              formControlName="room"
              placeholder="e.g., Room 101"
              class="form-control">
          </div>
        </div>
      </div>

      <!-- Prerequisites -->
      <div class="form-section">
        <div class="section-header">
          <h3><i class="fas fa-sitemap mr-2"></i> Prerequisites</h3>
          <p class="section-subtitle">Select courses that must be completed before this course</p>
        </div>
        
        <div class="form-group">
          <label>Select Prerequisites</label>
          <div class="prerequisites-list">
            <div *ngIf="courses.length === 0" class="text-muted p-3 text-center">
              No other courses available to select as prerequisites
            </div>
            
            <div *ngFor="let course of courses" 
                 class="prerequisite-item"
                 [class.selected]="isPrerequisiteSelected(course._id!)"
                 (click)="togglePrerequisite(course._id!)">
              <div class="prerequisite-code">{{ course.courseCode }}</div>
              <div class="prerequisite-name">{{ course.courseName }}</div>
              <div class="prerequisite-check">
                <i class="fas" [class.fa-check]="isPrerequisiteSelected(course._id!)"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Grading Policy -->
      <div class="form-section">
        <div class="section-header">
          <h3><i class="fas fa-percentage mr-2"></i> Grading Policy</h3>
          <p class="section-subtitle">Set weightage for different components (should total 100%)</p>
        </div>
        
        <div class="grading-policy-grid" formGroupName="gradingPolicy">
          <!-- Assignments -->
          <div class="form-group">
            <label for="assignments">Assignments (%)</label>
            <input 
              type="number" 
              id="assignments" 
              formControlName="assignments"
              min="0"
              max="100"
              class="form-control">
          </div>

          <!-- Midterm -->
          <div class="form-group">
            <label for="midterm">Midterm (%)</label>
            <input 
              type="number" 
              id="midterm" 
              formControlName="midterm"
              min="0"
              max="100"
              class="form-control">
          </div>

          <!-- Final -->
          <div class="form-group">
            <label for="final">Final (%)</label>
            <input 
              type="number" 
              id="final" 
              formControlName="final"
              min="0"
              max="100"
              class="form-control">
          </div>

          <!-- Projects -->
          <div class="form-group">
            <label for="projects">Projects (%)</label>
            <input 
              type="number" 
              id="projects" 
              formControlName="projects"
              min="0"
              max="100"
              class="form-control">
          </div>

          <!-- Attendance -->
          <div class="form-group">
            <label for="attendance">Attendance (%)</label>
            <input 
              type="number" 
              id="attendance" 
              formControlName="attendance"
              min="0"
              max="100"
              class="form-control">
          </div>
        </div>

        <!-- Total Calculation -->
        <div class="grading-total" 
             [class.warning]="calculateTotalWeight() > 0 && calculateTotalWeight() !== 100"
             [class.error]="calculateTotalWeight() > 100"
             [class.success]="calculateTotalWeight() === 100">
          Total Weight: <span class="total">{{ calculateTotalWeight() }}%</span>
          <div *ngIf="calculateTotalWeight() !== 100 && calculateTotalWeight() > 0" class="mt-1">
            <small *ngIf="calculateTotalWeight() < 100">{{ 100 - calculateTotalWeight() }}% remaining</small>
            <small *ngIf="calculateTotalWeight() > 100">{{ calculateTotalWeight() - 100 }}% over</small>
          </div>
        </div>
      </div>

      <!-- Course Resources -->
      <div class="form-section">
        <div class="section-header">
          <h3><i class="fas fa-paperclip mr-2"></i> Course Resources</h3>
          <p class="section-subtitle">Add resources like syllabus, notes, assignments</p>
        </div>
        
        <div formArrayName="resources">
          <div class="resources-list">
            <div *ngFor="let resource of resources.controls; let i = index" 
                 [formGroupName]="i"
                 class="resource-item">
              <div class="resource-fields">
                <!-- Resource Type -->
                <div class="form-group">
                  <label>Resource Type</label>
                  <select formControlName="type" class="form-control">
                    <option value="Syllabus">Syllabus</option>
                    <option value="Notes">Notes</option>
                    <option value="Assignment">Assignment</option>
                    <option value="Reference">Reference</option>
                    <option value="Video">Video</option>
                  </select>
                </div>

                <!-- Resource Title -->
                <div class="form-group">
                  <label>Title</label>
                  <input 
                    type="text" 
                    formControlName="title"
                    placeholder="e.g., Course Syllabus"
                    class="form-control">
                </div>

                <!-- Resource URL -->
                <div class="form-group">
                  <label>URL/Link</label>
                  <input 
                    type="url" 
                    formControlName="url"
                    placeholder="e.g., https://example.com/syllabus.pdf"
                    class="form-control">
                </div>
              </div>

              <div class="resource-action">
                <button type="button" class="btn btn-danger" (click)="removeResource(i)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
          
          <button type="button" class="btn btn-secondary mt-3" (click)="addResource()">
            <i class="fas fa-plus mr-2"></i> Add Resource
          </button>
        </div>
      </div>

      <!-- Description -->
      <div class="form-section">
        <div class="section-header">
          <h3><i class="fas fa-align-left mr-2"></i> Description</h3>
        </div>
        
        <div class="form-group">
          <label for="description">Course Description</label>
          <textarea 
            id="description" 
            formControlName="description"
            placeholder="Enter course description..."
            rows="6"
            class="form-control"
            maxlength="1000"></textarea>
          <div class="form-hint">
            {{ courseForm.get('description')?.value?.length || 0 }}/1000 characters
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="onCancel()">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="courseForm.invalid || submitting">
          <i class="fas" [class.fa-save]="!submitting" [class.fa-spinner]="submitting"></i>
          {{ submitting ? 'Saving...' : (isEditMode ? 'Update Course' : 'Create Course') }}
        </button>
      </div>
    </form>
  </div>
</div>